# Vulnerability Assessment: Medium Paywall Architecture

## Severity Classification

| ID | Vulnerability | Severity | Exploitability | Fix Complexity |
|---|---|---|---|---|
| V-01 | Soft paywall — full content in HTML response | Critical | Trivial | High |
| V-02 | No Googlebot IP verification | High | Trivial | Low |
| V-03 | Full article body in `__NEXT_DATA__` JSON | High | Trivial | Medium |
| V-04 | Friend Links cacheable by third parties | Medium | Low | Medium |
| V-05 | RSS feeds with full content enabled | Medium | Trivial | Low |
| V-06 | No TLS/JA3 fingerprint-based bot detection | Medium | Low | Medium |
| V-07 | No ASN-level proxy traffic detection | Low | Low | Low |

---

## V-01: Soft Paywall — Full Content in HTML Response

**Description:** The complete article body is included in the server's HTML response
regardless of the user's subscription status. Paywall enforcement is JavaScript-only.

**Impact:** Any HTTP client bypasses the paywall by disabling JavaScript or parsing the
raw response body.

**Proof of Concept:**
```bash
curl -s "https://medium.com/some-article" \
  -H "User-Agent: curl/7.88" | grep -o '"body":{[^}]*}'
```

**Recommended Fix:** Migrate to a hard paywall. Serve only article metadata in the
initial HTML response. Deliver body content via an authenticated API call after the
client proves subscription status. See `countermeasures/platform/hard-paywall-design.md`.

---

## V-02: No Googlebot IP Verification

**Description:** Medium serves full content to any request with a Googlebot User-Agent
header, without verifying that the requesting IP is actually Google infrastructure.

**Impact:** Trivial bot impersonation grants full content access.

**Recommended Fix:** Cross-check all Googlebot User-Agent requests against Google's
published IP ranges via reverse DNS lookup. Reject or serve metered content to any
Googlebot claim from a non-Google IP. See `countermeasures/platform/bot-verification.py`.

---

## V-03: Full Article Body in `__NEXT_DATA__`

**Description:** Next.js embeds server-rendered Apollo cache state as a JSON blob
in `<script id="__NEXT_DATA__">`. This includes the complete article body under
`props.apolloState`.

**Impact:** Even without User-Agent spoofing, the full article is parseable from
any unauthenticated HTML response.

**Recommended Fix:**
- Exclude article body from the server-side rendered Apollo state for unauthenticated
  or unsubscribed users
- Perform a client-side fetch of article body after verifying subscription status
- This requires coordinating the Next.js data fetching layer with auth state

---

## V-04: Friend Links Cacheable by Third Parties

**Description:** Friend Links (`?source=friends_link`) bypass the paywall by design.
When these are posted publicly, scrapers cache the unlocked content permanently.

**Impact:** Writers' content can be permanently exposed if a single Friend Link is
shared publicly and cached by Freedium.

**Recommended Fix:**
- Implement short TTLs on Friend Links (e.g., 24–72 hours)
- Rate-limit Friend Link generation per user
- Log and alert on anomalous Friend Link access patterns (many unique IPs from one link)

---

## V-05: RSS Feeds With Full Content

**Description:** Medium's RSS endpoints may return the full article body depending
on publication settings.

**Impact:** Passive scraping without hitting any paywall or bot detection.

**Recommended Fix:**
- Truncate RSS feed content to a preview (e.g., first 200 words) for paywalled articles
- This is a configuration change, not an architecture change

---

## V-06: No TLS/JA3 Fingerprint-Based Bot Detection

**Description:** Automated HTTP clients (Go's `net/http`, Python `requests`, etc.)
produce distinct TLS handshake signatures (JA3/JA4 fingerprints) that differ from
real browsers. Medium does not appear to use this signal.

**Impact:** Bot traffic blends with organic browser traffic, making detection harder.

**Recommended Fix:**
- Integrate a bot management solution with TLS fingerprinting capability
  (Cloudflare Bot Management, DataDome, PerimeterX/HUMAN)
- Flag anomalous JA3 fingerprints for additional verification challenges

---

## V-07: No ASN-Level Proxy Traffic Detection

**Description:** Freedium is hosted on datacenter infrastructure (Hetzner, OVH, etc.).
Real Medium readers are overwhelmingly on residential or mobile ISP ASNs.

**Impact:** Freedium's server IPs are identifiable by ASN and can be blocked.

**Recommended Fix:**
- Block or aggressively challenge requests from datacenter ASNs that have no
  legitimate reason to read Medium articles
- This is a partial, bypass-able measure but raises the operational cost for Freedium

---

## Risk Model: What Doesn't Work

The following approaches are commonly suggested but provide limited protection:

| Approach | Why It Fails |
|---|---|
| Blocking Freedium's IPs | They rotate IPs trivially; cached content already off-platform |
| CAPTCHA on all requests | Destroys user experience; Freedium can solve at scrape time |
| Obfuscating article HTML | Trivially reversible; doesn't address `__NEXT_DATA__` |
| Takedown of freedium.cfd | OSS forks proliferate; doesn't fix the root vulnerability |
| Watermarking alone | Useful for attribution, not for prevention |

**The only durable fix is migrating to a hard paywall (V-01).**
All other measures are defense-in-depth layers that raise attacker cost.
